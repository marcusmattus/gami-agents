# Gami Protocol - System Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          GAMI PROTOCOL ECOSYSTEM                             │
│                     Web3 Loyalty & Gamification Platform                     │
└─────────────────────────────────────────────────────────────────────────────┘

                                 ┌──────────┐
                                 │  USERS   │
                                 │ (Wallets)│
                                 └────┬─────┘
                                      │
                          ┌───────────┴───────────┐
                          │   MCP EVENT STREAM    │
                          │   (Model Context      │
                          │    Protocol)          │
                          └───────────┬───────────┘
                                      │
            ┌─────────────────────────┼─────────────────────────┐
            │                         │                         │
            ▼                         ▼                         ▼
┌────────────────────┐   ┌────────────────────┐   ┌────────────────────┐
│  QUEST GENERATION  │   │     ECONOMY        │   │     SECURITY       │
│      AGENT         │   │   MANAGEMENT       │   │      AGENT         │
│                    │   │      AGENT         │   │                    │
│  🤖 Port 8001      │   │  💰 Port 8002      │   │  🔒 Port 8003      │
├────────────────────┤   ├────────────────────┤   ├────────────────────┤
│                    │   │                    │   │                    │
│ ┌────────────────┐ │   │ ┌────────────────┐ │   │ ┌────────────────┐ │
│ │  Q-LEARNING    │ │   │ │ MONTE CARLO    │ │   │ │  ISOLATION     │ │
│ │  RL MODEL      │ │   │ │  SIMULATION    │ │   │ │   FOREST       │ │
│ │                │ │   │ │                │ │   │ │                │ │
│ │ • State Space  │ │   │ │ • 1000 iter    │ │   │ │ • 7 features   │ │
│ │ • Action Space │ │   │ │ • 30-day       │ │   │ │ • Sybil detect │ │
│ │ • Epsilon-ε    │ │   │ │ • Confidence   │ │   │ │ • Auto-lock    │ │
│ └────────────────┘ │   │ └────────────────┘ │   │ └────────────────┘ │
│                    │   │                    │   │                    │
│ OUTPUT:            │   │ OUTPUT:            │   │ OUTPUT:            │
│ • Difficulty 1-10  │   │ • XP/GAMI rate     │   │ • Anomaly score    │
│ • Rewards (XP,$)   │   │ • Inflation %      │   │ • User status      │
│ • Completion rules │   │ • Deflation flag   │   │ • Fraud alerts     │
│                    │   │                    │   │                    │
│ CONSTRAINT:        │   │ TRIGGER:           │   │ TRIGGER:           │
│ Rep < 20 → Easy    │   │ Inflation > 5%     │   │ XP > 3×std         │
└──────┬─────────────┘   └──────┬─────────────┘   └──────┬─────────────┘
       │                        │                        │
       │                        │                        │
       └────────────────────────┼────────────────────────┘
                                │
                    ┌───────────┴────────────┐
                    │                        │
                    ▼                        ▼
           ┌─────────────────┐     ┌─────────────────┐
           │   POSTGRESQL    │     │      REDIS      │
           │   (Relational)  │     │   (Hot State)   │
           │                 │     │                 │
           │ • users         │     │ • emission_rate │
           │ • quests        │     │ • circuit_break │
           │ • mcp_events    │     │ • cache         │
           │ • fraud_alerts  │     │                 │
           └─────────────────┘     └─────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            DATA MODEL SCHEMAS
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│ USER IDENTITY                                                                │
├─────────────────────────────────────────────────────────────────────────────┤
│ wallet_id         : string  (EVM/Solana address)                            │
│ xp_balance        : int     (≥0, non-transferable)                          │
│ reputation_score  : float   (0.0 - 100.0)                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ MCP EVENT                                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│ event_id    : UUID                                                           │
│ user_id     : string                                                         │
│ source      : 'web2' | 'web3'                                                │
│ action_type : string                                                         │
│ meta_data   : JSON                                                           │
│ timestamp   : ISO8601                                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ QUEST                                                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│ quest_id             : UUID                                                  │
│ difficulty_rating    : int    (1-10)                                         │
│ reward_xp            : int    (≥0)                                           │
│ reward_gami          : float  (≥0)                                           │
│ completion_criteria  : JSON   (rule_set)                                     │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                         AGENT COMMUNICATION FLOW
═══════════════════════════════════════════════════════════════════════════════

    USER                                          ORCHESTRATOR
     │                                                 │
     │ 1. Perform Action                              │
     ├────────────────────────────────────────────────►
     │                                                 │
     │                        2. Generate MCP Event    │
     │                        ┌────────────────────────┤
     │                        │                        │
     │                        ▼                        │
     │              ┌──────────────────┐               │
     │              │  EVENT INGESTION │               │
     │              └────┬─────────────┘               │
     │                   │                             │
     │         ┌─────────┼─────────┐                   │
     │         ▼         ▼         ▼                   │
     │    [Quest]   [Economy]  [Security]              │
     │         │         │         │                   │
     │         │         │         └──► Lock User (if fraud)
     │         │         │                             │
     │         │         └──► Get Rate                 │
     │         │         ◄─── Return Rate              │
     │         │                                       │
     │         └──► Generate Quest                     │
     │         ◄─── Return Quest                       │
     │                                                 │
     │ 3. Receive Personalized Quest                   │
     ◄─────────────────────────────────────────────────┤
     │                                                 │


═══════════════════════════════════════════════════════════════════════════════
                            DEPLOYMENT TOPOLOGY
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                         DOCKER COMPOSE NETWORK                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────┐  ┌──────────────────┐  ┌──────────────────┐          │
│  │ quest_generation │  │ economy_mgmt     │  │ security_agent   │          │
│  │ :8001            │  │ :8002            │  │ :8003            │          │
│  └────────┬─────────┘  └────────┬─────────┘  └────────┬─────────┘          │
│           │                     │                     │                     │
│           └─────────────────────┼─────────────────────┘                     │
│                                 │                                           │
│                     ┌───────────┴────────────┐                              │
│                     │                        │                              │
│           ┌─────────▼──────────┐  ┌──────────▼─────────┐                   │
│           │   gami_postgres    │  │   gami_redis       │                   │
│           │   :5432            │  │   :6379            │                   │
│           └────────────────────┘  └────────────────────┘                   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

    HOST SYSTEM
    ───────────────────────────────────────────
    localhost:8001 → Quest Agent
    localhost:8002 → Economy Agent
    localhost:8003 → Security Agent
    localhost:5432 → PostgreSQL
    localhost:6379 → Redis


═══════════════════════════════════════════════════════════════════════════════
                        ML/AI ALGORITHMS OVERVIEW
═══════════════════════════════════════════════════════════════════════════════

┌──────────────────────────────────────────────────────────────────────┐
│ QUEST AGENT: Q-LEARNING                                              │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Q(s,a) ← Q(s,a) + α[R + γ max Q(s',a') - Q(s,a)]                  │
│                        a'                                           │
│                                                                      │
│  Where:                                                             │
│    s = state (rep_bucket, activity, completion_rate)               │
│    a = action (difficulty 1-10)                                    │
│    α = learning rate (0.1)                                         │
│    γ = discount factor (0.95)                                      │
│    R = reward (+10 retained, -5 churned)                           │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│ ECONOMY AGENT: MONTE CARLO                                          │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  S(t+1) = S(t) + E(t)                                               │
│                                                                      │
│  Where:                                                             │
│    S(t) = supply at time t                                         │
│    E(t) = S(t) × 0.001 × (1 + adoption/100) × (1 + volatility)    │
│    volatility ~ Uniform(-0.05, 0.05)                               │
│    adoption ~ Normal(μ, σ=0.2μ)                                    │
│                                                                      │
│  Inflation = (S(30) - S(0)) / S(0) × 100                           │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────┐
│ SECURITY AGENT: ISOLATION FOREST                                    │
├──────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  Anomaly Score = -1 × average path length in trees                 │
│                                                                      │
│  Features (7D):                                                     │
│    f1 = event_frequency (events/hour)                              │
│    f2 = xp_rate (XP/hour)                                          │
│    f3 = action_diversity                                           │
│    f4 = web3_ratio                                                 │
│    f5 = time_variance                                              │
│    f6 = avg_event_interval                                         │
│    f7 = burst_score                                                │
│                                                                      │
│  Sybil Threshold: μ + 3σ (XP rate)                                 │
│                                                                      │
└──────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            QUICK START GUIDE
═══════════════════════════════════════════════════════════════════════════════

1. START SERVICES
   $ ./start.sh
   OR
   $ docker-compose up -d

2. RUN TESTS
   $ python test_agents.py

3. EXPLORE APIs
   • Quest:    http://localhost:8001/docs
   • Economy:  http://localhost:8002/docs
   • Security: http://localhost:8003/docs

4. INTEGRATE
   • Connect frontend to agent APIs
   • Stream MCP events to Security Agent
   • Use Economy Agent for token minting rates

═══════════════════════════════════════════════════════════════════════════════
```
